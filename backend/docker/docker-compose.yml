version: "3.7"

services:
  web:
    image: richarvey/nginx-php-fpm:latest
    build:
      context: .
      dockerfile: Dockerfile.web
    ports:
      - ${GENEDIVE_PORT}:80
    volumes:
      - ./blank.txt:/etc/nginx/conf.d/nginx.conf.default # Disables the default server
      - ../../frontend/api:/var/www/html/api
      - ../../frontend/admin:/var/www/html/admin
      - ../../frontend/phpLib:/var/www/html/phpLib
      - ../../frontend/phpseclib:/var/www/html/phpseclib
      - ./site.conf:/etc/nginx/conf.d/site.conf
      - ./scripts:/scripts
      - ./data:/data
      - ./keys:/keys
    networks:
      - backend
      - default
    environment:
      - IS_DOCKER_CONTAINER=${IS_DOCKER_CONTAINER}
      - GENEDIVE_NAME=${GENEDIVE_NAME}
  python:
    image: python:latest
    build:
      context: .
      dockerfile: Dockerfile.python
    volumes:
      - ./scripts:/scripts
      - ./data:/data
      - ./keys:/keys
    tty: true
    #command: tail -f /dev/null
    # python /scripts/init.py
    environment:
      - GENEDIVE_NAME=${GENEDIVE_NAME}
    ports:
      - "22:22"
    networks:
      backend:
        aliases:
          - python_container

networks:
  backend:
    driver: bridge
