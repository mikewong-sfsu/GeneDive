<!DOCTYPE html>
<html lang="en">
<head>
  <title>Bootstrap Example</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="../../bootstrap/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <!--script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script-->

<style>
.parameter {
  /*background-color: #eee;*/
}
code {
  display: block;
  white-space: pre-wrap   
}
</style>
</head>
<body>
<div>
<div class="container">
  <div class="row">
    <h1>GeneDive API documentation</h1>
  </div>
  <div class="row">
    <p>GeneDive is a powerful tool used to import, search, sort, filter, highlight and visualize results of querying 
   interactions between Diseases, Genes and dRugs(DGR). Refer to Previde et. al.[2018] for more details on the functionalities offered.
    </p>
    <p>
   GeneDive 3.0 provides advanced features to add custom behaviour to visualize user imported data sources using APIs mentioned below.
    </p>
  </div>
  <div class="row">
	  <h3><div id="addSummaryColumnAPI"> AddSummaryColumn</div></h3>
  <p>This API enables users to visualize data in the summary view. Common usage include aggregation over interaction data grouped by 
  DGR as well as grouped by Article.The user can acess the data in a specific column by using the <a href="#getColumnAPI">getColumnAPI</a>. 
  <div class="parameter">
    <p><b>Input Parameters:</b><br>
    <i>group_id</i> - ids used to identify interaction data grouped by DGR or Article ID
    </p>
    <p><b>Return type:</b></br>
    <i>summaryColumnMap</i> - A javascript map variable with Custom column header as <i>key</i> and function mapping the value displayed in column as <i>value</i>
    </p>
  </div>
    <p><b>Method Definition</b>
<pre>
addSummaryColumns(group_id){
  var summaryColumnMap = new Map();
  return summaryColumnMap;
}</pre>
    </p>
  </div>
  <div class="row">
    <p><b>Example Implementation</b></p>
    <ol>
    <li>
      <p>
      If column "x" is mapped to a value assigned to each interaction, the following code snippet will let 
      user to add a column "x max." to the summary view mapping the max value of column "x" for each group of interaction data.
      </p>
<pre>
addSummaryColumns(group_id){
  var summaryColumnMap = new Map();    //add all custom summary columns to this map
  var xvalues = this.getColumn('x');   //get list of x values in the interactions
  summaryColumnMap.set('x max.',() => (xvalues.sort((a,b) => b-a)[0]));    //function computes largest x value
  return summaryColumnMap;
}
</pre>
    </li>
    <li>
	    <p><a id="mathExample"></a>
      If column "y" is mapped to a value assigned to each interaction, the following code snippet will let 
      user to add a column "SD on y" to the summary view mapping the standard deviation on values in  column "y" for 
      each group of interaction data. The standard deviation is calculated by using the <b>math.js</b> library. More information on the 
      examples and features supported by the library can be found at <a href="https://mathjs.org">https://mathjs.org</a>.
      </p>
<pre>
addSummaryColumns(group_id){
  var summaryColumnMap = new Map();    //add all custom summary columns to this map
  var yvalues = this.getColumn('y');   //get list of x values in the interactions
  summaryColumnMap.set('SD on y',() => math.std(yvalues));    //function computes standard diviation on list of y values
  return summaryColumnMap;
}
</pre>
  </li>
  <li>
	  <p><a id="D3Example"></a>
    If column "z" is mapped to a float value assigned to each interaction, the following code snippet will let user
    to add a column "z bar" to the summary view with barcharts mapping all the values in column "z" for each interaction data. 
    The bar charts are generated by using the <b>D3</b> library. More information on generating the various kinds of vizualization using the library 
    can be found at <a href="https://d3js.org">https://d3js.org</a>.
    </p>
<pre>
addSummaryColumns(group_id){
  var summaryColumnMap = new Map();    //add all custom summary columns to this map
  var zvalues = this.getColumn('z');   //get list of z values in the group of interactions
  summaryColumnMap.set('z bar',() => this.plotBarGraph(zvalues, group_id)); //plot bar graph on z values
  return summaryColumnMap;
}

plotBarGraph(data, group_id){
  //create data compatible with d3
  var dataset = [];
  for(let i of data)
    dataset.push({"z": parseFloat(i)});
  //initialize html element for the graph
  var $value;
  var svg_id = "default_svg";
  //create graph for valid data
  if(data)
    svg_id = "chart_" + group_id ;  //create a unique id for the html element
  if(svg_id != "default_svg"){
    $value = $('$ltdiv class="distribution" id='+svg_id+'&gt&lt/div&gt');
    //create the barchart
    this.plotGraph(dataset, svg_id);
    var $barChart = $("#svg_"+svg_id).detach();
    var $ch_svg = $("#"+svg_id);
    $value = $value.append($barChart);
  }
  return $value;
}

//Create barchart using D3 library
plotGraph(dataset,svg_id ){
  //initialize size of barchart
  var width  = 200;
  var height = 100;
  var margin = {'top': 20, 'right': 20, 'bottom': 20, 'left': 20 };
  //initialize scale for barchart
  var xScale = d3.scaleBand()
    	.domain(dataset.map(function(d){ return d.x;}))
        .range([margin.left, width - margin.right]);

  var yScale = d3.scaleLinear()
    	.domain([0, 5])
    	.range([height - margin.top - margin.bottom, 0]);
  //initialize axis for barchart
  var xAxis = d3.axisBottom(xScale);
  var yAxis = d3.axisLeft(yScale).tickFormat("");

  //initialize the svg element
  var svg = d3.select("#result-table")   //create on table view
    	.append("svg")
        .attr("id",("svg_" + svg_id))      //important for mapping the barchart on the table
    	.attr('transform', 'translate(0,20)')
    	.attr("width",  width)
    	.attr("height", height)
    	.attr("margin", margin);

  svg.append('g')
    	.attr('class', 'x axis')
    	.attr('transform', 'translate(0,' + (height - margin.bottom - margin.top) + ')')
    	.call(xAxis);

  svg.selectAll(".bar")//"rect"
        .data(dataset)
        .enter().append("rect")
        .attr("class", "bar")
        .attr("x", function (d) { return xScale(d.x); })
        .attr("y", function (d) { return yScale(d.x); })
        .attr("height", function (d) { return height - margin.top - margin.bottom - yScale(d.x); })
        .attr("width", xScale.bandwidth())
        .text(function(d) { return d.x * 100; })
        .attr("fill", "#1f77b4");//grey

   svg.selectAll("text.bar")
       .data(dataset)
    	.enter().append("text")
      	.attr("class", "bar")
      	.attr("text-anchor", "middle")
      	.attr("x", function(d) { return xScale(d.x); })
      	.attr("y", function(d) { return yScale(d.x); });
}
</pre>
  </li>
  </ol>
  </div>
  <div class="row">
    <h3><a id="addDetailColumnAPI">AddDetailColumn</a></h3>
    <p>This API enables users to visualize data in the detail view. Common usage include mapping values within nested data objects, visualization in the forms of charts and graphs based on data, etc.The API works similar to <a href = "#addSummaryColumnAPI"=>AddSummaryColumn </a>, but maps values to each DGR interaction data.
The user can acess the data in a specific column by using the <a href="#getColumnAPI">getColumnAPI</a>. 
  <div class="parameter">
    <p><b>Return type:</b></br>
    <i>detailColumnMap</i> - A javascript map variable with Custom column header as <i>key</i> and function mapping the value displayed in column as <i>value</i>
    </p>
  </div>
    <p><b>Method Definition</b>
<pre>
addDetailColumns(){
  var detailColumnMap = new Map();
  return detailColumnMap;
}</pre>
    </p>
  </div>
<div class="row">
    <p><b>Example Implementation</b></p>
    <ol>
    <li>
      <p>
      If column "x" is mapped to a JSON object with properties (or keys) "a", "b" for each DGR interaction data, the following code snippet will let user to extract values mapped to property "a" within the column "x". For example
      </p>
      <p>Let x = {"a" : value1, "b" : value2 };</p>
      User adds a column called "A" whch holds the value "value1".</p>
<pre>
addDetailColumns(){
  var detailColumnMap = new Map();    //add all custom summary columns to this map
  var xvalue = this.getColumn('x');   //get x value from the interactions data //type string
  var parseXvalue = JSON.parse(parseXvalue); //parse value to JSON object
  detailColumnMap.set('a',() => (parseXvalue.a));    //map value for key = a
  detailColumnMap.set('b',() => (parseXvalue.b));    //map value for key = b
  return detailColumnMap;
}
</pre>
    </li>
    </ol>
    Refer to <a href="#mathExample">Examples to use math function</a> and <a href="#D3Example"> Examples to use D3 functions</a> for more implementations using library functions for mapping the custom column . 
  </div>
  <div class="row">
    <h3><a id="getColumnAPI">getColumn</a></h3>
    <p>A helper function that lets user acess the data in a specific column.On summary view, the function returns list of values from all interactions within a group. On detail view, the function returns the value mapping the colunm name for each interaction. The column value obtained is of type string.
  <div class="parameter">
    <p><b>Input Parameters:</b><br>
    <i>columnName</i> - name of the column in the interaction data
    </p>
    <p><b>Return type:</b></br>
    <i>columnValue</i> - Returns the value mapped to column name in each interaction data on detail view. Returns a list of values mapped to column name for all interaction in a group in the summary view.
    </p>
  </div>
    <p><b>Method Definition</b>
<pre>
getColumn(columnName){
  return columnValue;
}</pre>
    </p>
  </div>
</div>
</div>

</body>
</html>

