<!DOCTYPE html>
<html lang="en">
<head>
  <title>GeneDive API Documentation</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="../../bootstrap/bootstrap.min.css">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<style>
.testheight {
  height:1200px;
  font-size:20px;
  text-align:center;
  padding:100px 20px;
}
.scrolltop {
	display:none;
	width:100%;
	margin:0 auto;
	position:fixed;
	bottom:20px;
	right:10px;	
}
.scroll {
	position:absolute;
	right:20px;
	bottom:20px;
	background:#b2b2b2;
	background:rgba(178,178,178,0.7);
	padding:20px;
	text-align: center;
	margin: 0 0 0 0;
	cursor:pointer;
	transition: 0.5s;
	-moz-transition: 0.5s;
	-webkit-transition: 0.5s;
	-o-transition: 0.5s; 		
}
.scroll:hover {
	background:rgba(178,178,178,1.0);
	transition: 0.5s;
	-moz-transition: 0.5s;
	-webkit-transition: 0.5s;
	-o-transition: 0.5s; 		
}
.scroll:hover .fa {
	padding-top:-10px;
}
.scroll .fa {
	font-size:30px;
	margin-top:-5px;
	margin-left:1px;
	transition: 0.5s;
	-moz-transition: 0.5s;
	-webkit-transition: 0.5s;
	-o-transition: 0.5s; 	
}
code {
  display: block;
  white-space: pre-wrap   
}
</style>
</head>
<body>
<div>
<div class="container">
  <div class='scrolltop'>
    <div class='scroll icon'><i class="fa fa-4x fa-angle-up"></i></div>
  </div>
  <div class="row">
    <h1 class="APIDoc">GeneDive API documentation</h1>
  </div>
  <div class="row">
    <p>GeneDive is a powerful tool used to import, search, sort, filter, highlight and visualize results of querying 
   interactions between Diseases, Genes and dRugs(DGR). Refer to Previde et. al.[2018] for more details on the functionalities offered.
    </p>
    <p>
   GeneDive 3.0 provides advanced features to add custom behaviour to visualize user imported data sources using APIs mentioned below.
    </p>
  </div>
  <div class=" row tableOfContents">
  <div>

	  <h3 id="addSummaryColumnAPI" class="navLink"> addSummaryColumn</h3>
  <p>This API enables users to visualize data in the summary view. Common usage include aggregation over interaction data grouped by 
  DGR as well as grouped by Article.The user can acess the data in a specific column by using the <a href="#getColumnAPI">getColumnAPI</a>. 
  <div class="parameter">
    <p><b>Input Parameters:</b><br>
    <i>group_id</i> - ids used to identify interaction data grouped by DGR or Article ID
    </p>
    <p><b>Return type:</b></br>
    <i>summaryColumnMap</i> - A javascript map variable with Custom column header as <i>key</i> and function mapping the value displayed in column as <i>value</i>
    </p>
  </div>
    <p><b>Method Definition</b>
<pre>
addSummaryColumns(group_id){
  var summaryColumnMap = new Map();
  return summaryColumnMap;
}</pre>
    </p>
  </div>
  <div>
    <p><b>Example Implementation</b></p>
    <ol>
    <li>
      <p>
      If column "x" is mapped to a value assigned to each interaction, the following code snippet will let 
      user to add a column "x max." to the summary view mapping the max value of column "x" for each group of interaction data.
      </p>
<pre>
addSummaryColumns(group_id){
  var summaryColumnMap = new Map();    //add all custom summary columns to this map
  var xvalues = this.getColumn('x');   //get list of x values in the interactions
  summaryColumnMap.set('x max.',() => (xvalues.sort((a,b) => b-a)[0]));    //function computes largest x value
  return summaryColumnMap;
}
</pre>
    </li>
    <li>
	    <p><a id="mathExample"></a>
      If column "y" is mapped to a value assigned to each interaction, the following code snippet will let 
      user to add a column "SD on y" to the summary view mapping the standard deviation on values in  column "y" for 
      each group of interaction data. The standard deviation is calculated by using the <b>math.js</b> library. More information on the 
      examples and features supported by the library can be found at <a href="https://mathjs.org" target="_blank">https://mathjs.org</a>.
      </p>
<pre>
addSummaryColumns(group_id){
  var summaryColumnMap = new Map();    //add all custom summary columns to this map
  var yvalues = this.getColumn('y');   //get list of x values in the interactions
  summaryColumnMap.set('SD on y',() => math.std(yvalues));    //function computes standard diviation on list of y values
  return summaryColumnMap;
}
</pre>
  </li>
  <li>
	  <p><a id="D3Example"></a>
    If column "z" is mapped to a float value assigned to each interaction, the following code snippet will let user
    to add a column "z bar" to the summary view with barcharts mapping all the values in column "z" for each interaction data. 
    The bar charts are generated by using the <b>D3</b> library. More information on generating the various kinds of vizualization using the library 
    can be found at <a href="https://d3js.org" target="_blank">https://d3js.org</a>.
    </p>
<pre>
addSummaryColumns(group_id){
  var summaryColumnMap = new Map();    //add all custom summary columns to this map
  var zvalues = this.getColumn('z');   //get list of z values in the group of interactions
  summaryColumnMap.set('z bar',() => this.plotBarGraph(zvalues, group_id)); //plot bar graph on z values
  return summaryColumnMap;
}

plotBarGraph(data, group_id){
  //create data compatible with d3
  var dataset = [];
  for(let i of data)
    dataset.push({"z": parseFloat(i)});
  //initialize html element for the graph
  var $value;
  var svg_id = "default_svg";
  //create graph for valid data
  if(data)
    svg_id = "chart_" + group_id ;  //create a unique id for the html element
  if(svg_id != "default_svg"){
    $value = $('&ltdiv class="distribution" id='+svg_id+'&gt&lt/div&gt');
    //create the barchart
    this.plotGraph(dataset, svg_id);
    var $barChart = $("#svg_"+svg_id).detach();
    var $ch_svg = $("#"+svg_id);
    $value = $value.append($barChart);
  }
  return $value;
}

//Create barchart using D3 library
plotGraph(dataset,svg_id ){
  //initialize size of barchart
  var width  = 200;
  var height = 100;
  var margin = {'top': 20, 'right': 20, 'bottom': 20, 'left': 20 };
  //initialize scale for barchart
  var xScale = d3.scaleBand()
    	.domain(dataset.map(function(d){ return d.x;}))
        .range([margin.left, width - margin.right]);

  var yScale = d3.scaleLinear()
    	.domain([0, 5])
    	.range([height - margin.top - margin.bottom, 0]);
  //initialize axis for barchart
  var xAxis = d3.axisBottom(xScale);
  var yAxis = d3.axisLeft(yScale).tickFormat("");

  //initialize the svg element
  var svg = d3.select("#result-table")   //create on table view
    	.append("svg")
        .attr("id",("svg_" + svg_id))      //important for mapping the barchart on the table
    	.attr('transform', 'translate(0,20)')
    	.attr("width",  width)
    	.attr("height", height)
    	.attr("margin", margin);

  svg.append('g')
    	.attr('class', 'x axis')
    	.attr('transform', 'translate(0,' + (height - margin.bottom - margin.top) + ')')
    	.call(xAxis);

  svg.selectAll(".bar")//"rect"
        .data(dataset)
        .enter().append("rect")
        .attr("class", "bar")
        .attr("x", function (d) { return xScale(d.x); })
        .attr("y", function (d) { return yScale(d.x); })
        .attr("height", function (d) { return height - margin.top - margin.bottom - yScale(d.x); })
        .attr("width", xScale.bandwidth())
        .text(function(d) { return d.x * 100; })
        .attr("fill", "#1f77b4");//grey

   svg.selectAll("text.bar")
       .data(dataset)
    	.enter().append("text")
      	.attr("class", "bar")
      	.attr("text-anchor", "middle")
      	.attr("x", function(d) { return xScale(d.x); })
      	.attr("y", function(d) { return yScale(d.x); });
}
</pre>
  </li>
  </ol>
  </div>
  <div>
    <h3 id="addDetailColumnAPI">addDetailColumn</h3>
    <p>This API enables users to visualize data in the detail view. Common usage include mapping values within nested data objects, visualization in the forms of charts and graphs based on data, etc.The API works similar to <a href = "#addSummaryColumnAPI"=>AddSummaryColumn </a>, but maps values to each DGR interaction data.
The user can acess the data in a specific column by using the <a href="#getColumnAPI">getColumnAPI</a>. 
  <div class="parameter">
    <p><b>Return type:</b></br>
    <i>detailColumnMap</i> - A javascript map variable with Custom column header as <i>key</i> and function mapping the value displayed in column as <i>value</i>
    </p>
  </div>
    <p><b>Method Definition</b>
<pre>
addDetailColumns(){
  var detailColumnMap = new Map();
  return detailColumnMap;
}</pre>
    </p>
  </div>
<div>
    <p><b>Example Implementation</b></p>
    <ol>
    <li>
      <p>
      If column "x" is mapped to a JSON object with properties (or keys) "a", "b" for each DGR interaction data, the following code snippet will let user to extract values mapped to property "a" within the column "x". For example
      </p>
      <p>Let x = {"a" : value1, "b" : value2 };</p>
      User adds a column called "A" whch holds the value "value1".</p>
<pre>
addDetailColumns(){
  var detailColumnMap = new Map();    //add all custom detail columns to this map
  var xvalue = this.getColumn('x');   //get x value from the interactions data //type string
  var parseXvalue = JSON.parse(parseXvalue); //parse value to JSON object
  detailColumnMap.set('a',() => (parseXvalue.a));    //map value for key = a
  detailColumnMap.set('b',() => (parseXvalue.b));    //map value for key = b
  return detailColumnMap;
}
</pre>
    </li>
    </ol>
    Refer to <a href="#mathExample">Examples to use math function</a> and <a href="#D3Example"> Examples to use D3 functions</a> for more implementations using library functions for mapping the custom column . 
  </div>
  <div>
    <h3 id="getColumnAPI">getColumn</h3>
    <p>A helper function that lets user acess the data in a specific column.On summary view, the function returns list of values from all interactions within a group. On detail view, the function returns the value mapping the colunm name for each interaction. The column value obtained is of type string.
    <ol>
    <li>
    <div class="parameter">
    <p><b>Input Parameters:</b><br>
    <i>columnName</i> - name of the column in the interaction data
    </p>
    <p><b>Return type:</b></br>
    <i>columnValue</i> - Returns the value mapped to column name in each interaction data on detail view. Returns a list of values mapped to column name for all interaction in a group in the summary view. This method is commonly used in <a href="#addSummaryColumnAPI">addSummaryColumn</a> and <a href="#addDetailColumnAPI">addDetailColumn</a> API.
.
    </p>
    <p><b>Method Definition</b>
<pre>
getColumn(columnName){
  return columnValue;
}</pre>
    </p>
  </div>
    </li>
    <li>
    <div>
    <p><b>Input Parameters:</b><br>
    <i>columnName</i> - name of the column in the interaction data
    <i>interaction</i> - single DGR interaction data
    </p>
    <p><b>Return type:</b></br>
    <i>columnValue</i> - Returns the value mapped to column name for the interaction data in "interaction". This method is commonly used in <a href="#addFilterAPI">addFilter</a> and <a href="#addHighlightAPI">addHighlight</a> API.
    </p>
    <p><b>Method Definition</b>
<pre>
getColumn(columnName){
  return columnValue;
}</pre>
    </p>
  </div>
    </li>
    </ol>
   </div>
  <!---addFilterAPI--->
  <div>
    <h3 id="addFilterAPI">addFilter</h3>
    <p>This API enables users to add custom filtering options to filter data from user defined datasources. The user may create a filter using the <a href="#filter">Filter</a> class. Filter options are added to the Filter options dropdown on the control view.
  <div class="parameter">
    <p><b>Input Parameter: </b><br>
    <i>interactions</i> - DGR interaction data obtained on search query.
    <p><b>Return type:</b></br>
    <i>filterMap</i> - A javascript map variable with Custom filter options as <i>key</i> and <a href="#filter">Filter</a> object <i>value</i>
    </p>
  </div>
    <p><b>Method Definition</b>
<pre>
addFilter(interactions){
  var filterMap = new Map();
  return filterMap;
}</pre>
    </p>
  </div>
<div>
    <p><b>Example Implementation</b></p>
      <p>
      If column "x" is mapped to a JSON object with properties (or keys) "a" and "b" mapping numeric values for each DGR interaction data.  the user can filter interaction data on maximum value of property "a" or "b" with the following code snippet.
      </p>
<pre>
addFilters(interactions){		
  var filterMap = new Map();	
  filterMap.set("Max Value",this.filterByMaxScore(interactions));//filter based on max value in "a" or "b"
  return filterMap;
}

filterThemeByMaxScore(interactions){
  var selection = ["a", "b"]
  //create a dropdown filter input element
  let $filterValue = $('&ltselect&gt',{'id':'selectMaxThemeScore'});
  selection.map((i) =>{
    $filterValue.append($(`&ltoption value="${i}"/&gt`).html(i));  //populate selection option in dropdown
  });
  //maxScorefilter
  return new Filter("MaxScore", this.getMaxScore, $filterValue);
}

//filter function for maxScore
getMaxScore(interactions, attribute){
  let filteredInteractions = interactions.filter((i) => {
    let xValue = this.getColumn("x",i); //get value of "x" for each interaction
    if(xValue){ if exists
      let parseX = JSON.parse(xValue);   //parse JSON to access "a" and "b"
      let maxAttribute = (parseX.a > parseX.b) ? "a" : "b" ; //get attribute with max value
      return (maxAttribute == attribute);
    }
  });
  return filteredInteractions;
}

</pre>
  </div>
  <!---addHighlightAPI--->
<div>
    <h3 id="addHighlightAPI">addHighlight</h3>
    <p>
    The user may add highlight filter to highlight interaction data based on text matching the values mapped to the column header specific to user defined data source 
    The added highlight filters can be applied from the Highlight settings in the control view. Each interaction data comes with a boolean highlight property. The user may set the highlight property to true to enable highlighting.The user can access the data in a specific column by using the <a href="#getColumnAPI">getColumnAPI</a>. 
  <div class="parameter">
    <p><b>Input Parameters:</b><br>
    <i>interactions</i> - DGR interaction data obtained on search query.
    <br>
    <i>term</i> - Free text input provided in the highlight filter.
    </p>
    <p><b>Return type:</b></br>
    <i>highlightMap</i> - A javascript map variable with Custom highlight option as <i>key</i> and function mapping the highlight filter as value <i>value</i> Each highlight filter function should return the interactions with updated highlight property.
    </p>
  </div>
    <p><b>Method Definition</b>
<pre>
addHighlight(interactions, term){
  var highlightMap = new Map();
  return highlightMap;
}</pre>
    </p>
  </div>
<div>
    <p><b>Example Implementation</b></p>
      <p>
      If "x" is a column obtained from user defined data source, the user may set a highlight filter that highlights interaction data by matching the free text input with the value mapped in column "x" as show.
      </p>
<pre>
addHighlight(interactions, term){
  var highlightMap = new Map();    //add all custom summary columns to this map
  highlightMap.set("x", () => this.highlightX(interactions, term));
  return highlightMap;

}
highlightX(interactions, term){
  //loop through interactions
  for(let i of interactions){
    let xValue = this.getColumn('x', i ); //get value mapped to x in interaction i
    i.highlight = new RegExp(term,"i").test(`${xValue}`); //sets to true if term found in xValue string
  }
  return interactions;
}
</pre>
</div>

<!---Filter--->
<div>
    <h3 id="filter">Filter</h3>
    <p>
	Filter is a custom class specifically designed to add custom filters option to the  GeneDive system.
 </p>
  <div class="parameter">
    <p><b>Class variables:</b><br>
    <i>attribute</i> - Name assigned to the Filter option. The filter options will be displayed in the filter dropdown on the control view.
    <br>
    <i>filterFunction</i> - The function defining the behaviour of the filter.
    <br>
    <i>filterValue</i> - The HTML element mapping the filter input for the selected Filter option.The default value is text input field. This is option parameter.
    <br>
    <i>addSelector</i> - String matching the selected filter value on Adding the Filter. This is an optional parameter useful while combining multiple subfilters.
    <br>
    </p>
    <p><b>Constructor:</b></br>
<pre>
constructor(filterName, filterFunction, filterSelector = $('&ltinput&gt',{'id':'filterText'}), selectorValue = null  )
  this.attribute = filterName;
  this.filterFunction = filterFunction;
  this.filterValue = filterSelector;
  this.addSelector = selectorValue;
}
</pre>
    </p>
  </div>
  </div>


  <div>
    <h3 id="Additional Resources">Additonal Resources</h3>
    <p>The following additional libaries are available for users to implement custom behaviour</p>
    <p><a href="https://d3js.org" target="_blank">D3.js</a> : A JavaScript library to manipulate data and create visualization using HTML, SVG and CSS</p>
    <p><a href="https://mathjs.org" target="_blank">Math.js</a> : A extensive math library for JavaScript</p>
    <p><a href="https://alertifyjs.com" target="_blank">Alertify.js</a> :  A JavaScript framework for developing browser dialogs and notifications</p>
    <p> <a href="https://jquery.com" target="_blank">JQuery</a> : A JavaScript library for DOM manipulation</p> 
  </div>
  <br><br>
</div>
</div>

<script>
///create Table of contents
var ToC =
  "<nav role='navigation' class='table-of-contents'>" +
    "<h2>On this page:</h2>" +
    "<ul>";

var newLine, el, title, link;

$("h3").each(function() {
  console.log("in here:");
  el = $(this);
  title = el.text();
  link = "#" + el.attr("id");

  newLine =
    "<li>" +
      "<a href='" + link + "'>" +
        title +
      "</a>" +
    "</li>";

  ToC += newLine;

});

ToC +=
   "</ul>" +
  "</nav>";

$(".tableOfContents").prepend(ToC);


//scroll to top
$(window).scroll(function() {
    if ($(this).scrollTop() > 50 ) {
        $('.scrolltop:hidden').stop(true, true).fadeIn();
    } else {
        $('.scrolltop').stop(true, true).fadeOut();
    }
});
$(function(){$(".scroll").click(function(){$("html,body").animate({scrollTop:$(".APIDoc").offset().top},"1000");return false})})
</script>
</body>
</html>

